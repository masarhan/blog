---
title: "المعالجات الحديثة معقدة"
date: 2023-02-25T09:00:01+03:00
draft: false
---

إن كنت قد درست مقرر معمارية الحاسوب Computer Architecture كما درسته أنا، مؤكد أنك مررت بتقسيم المعالجات إلى نوعين منفصلين ذو تعليمات مركبة CISC و ذو تعليمات مختزلة RISC. بدأ التقسيم بداية الثمانينات حين قدم مجموعة من أساتذة حامعة بيركيلي ورقة بعنوان The need for Reduced Instruction Set Computing، حيث بدأ تقسيم المعالجات حينها إلى نوعين متضادين، الأول ينفذ تعليمات كثيرة و مركبة Complex، ذات أطوال متغيرة variable-length encoding، تأخذ دورات زمنية متعددة many clock cycles، تعمل التعليمات على الذاكرة و المسجلات register-memory، هذه التعليمات مخزنة في برنامج microcode في ذاكرة مقروءة ROM و لها عدد أصغر من المسجلات. الثاني ينفذ تعليمات قليلة و بسيطة Reduced، ذات أطوال ثابتة fixed-length encoding، تعمل على المسجلات فقط register-register البيانات من الذاكرة لها تعليمات خاصة تحميل و تخزين load-store، مصممة بأن كل تعليمة لها دورة زمنية واحدة one clock per instruction، و هذه التعليمات ثابتة التوصيلات hardwired و لها عدد أكبر من المسجلات.

ينجز المعالج التعليمات البرمجية خلال دورة جلب-تحليل-تنفيذ fetch-decode-execute. في البداية يجلب المعالج التعليمة من الذاكرة، ثم يحللها و يعرف ما تفعله، ثم ينفذها و يخزن النتائج. أتت مفاهيم RISC لصناعة معالجات طبيعة التعليمات البسيطة فيها و التي ينفذها المعالج خلال دورة زمنية واحدة يسهل تنسيقها في خطوط متوازية pipelining للاستفادة أكثر من دورات المعالج. في الخطوط المتوازية، تنفذ المراحل بدرجة من التوازي. في أي تعليمة، يبدأ المعالج بجلب التعليمة من الذاكرة، ثم يحلل هذه التعليمة، أثناء تحليلها، يجلب المعالج التعليمة التي تليها، بعد ذلك ينفذ التعليمة الأولى، و يحلل التعليمة الثانية،و هكذا يستمر عمله. مواصفات RISC تسهل ذلك على عكس CISC.

{{< figure src="https://upload.wikimedia.org/wikipedia/commons/2/21/Fivestagespipeline.png" title="pipelining" >}}

منذ ذلك الحين و كتب معمارية الحاسوب تصنف المعالجات إلى هذين التصنيفين. لمن لم يدرس هذا المقرر، يعد مقرر معمارية الحاسوب من أصعب المقررات التي يمر بها الطلاب، و بعضهم يرى السبب في كثرة المفاهيم و المصطلحات وتعقيدها. تصنيف الأشياء يسهل على الطلاب فهم الأمور. طبيعي أن الطالب سيطبق المفاهيم التي درسها. لكن ليست كل المفاهيم تنطبق على الواقع. كثيرون يقيمون المعالجات بناء على ما درسوه، لكن الواقع ليس بتلك البساطة.

 {{< figure src="https://electronicsdesk.com/wp-content/uploads/2019/03/EU-architecture.jpg"  title="8086" >}}

تصنف معالجات x86 (التي تصنعها إنتل و AMD) أنها CISC، و يكثر الحديث أنها معالجات قديمة و لا تصلح. لو نظرنا لمعالجات x86 من إنتل و عرفنا تفاصيل أكثر، لعرفنا كذب تلك الادعاءات. مواصفات CISC التي تذكرها الكتب قد تصلح لفهم معالجات x86 القديمة، لكن ليست المعالجات الحديثة. معالج 8086 الذي منه بدأت معمارية x86 ذو خطوط متوازية pipelined و هذا قبل أن يظهر مفهوم RISC. معالج Pentium Pro ينفذ التعليمات بغير ترتيبها out-of-order execution. هذا النوع من المعالجات له عدد كبير من المسجلات أكثر من تلك التي يعرفها المبرمج الذي يبرمج للمعمارية.

 {{< figure src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e4/Intel_Pentium_Pro_Microarchitecture_Block_Diagram.svg/600px-Intel_Pentium_Pro_Microarchitecture_Block_Diagram.svg.png"  title="Pentium Pro" >}}

في الثمانينات كانت التوقعات أن معالجات x86 التي تنجها إنتل ستنتهي، و سيحل محلها معالجات بمواصفات RISC. خابت كل تلك التوقعات التي توقعت بنهاية x86، بينما لم تنتشر معالجات RISC كثيراً. عزا بعضهم السبب في أن إنتل تصنع بكثرة على عكس الشركات التي أنتجت معالجات بمواصفات RISC. لم أولد في تلك الفترة، لكن لا أظن أن هذا السبب منطقي. قد تبدو فكرة التعليمات القليلة التي يسهل جعلها في خطوط متوازية رائعة نظرياً، لكن عملياً ليست كذلك. عانت معالجات RISC من مشكلة المعالج الخامل idle الذي يملأ وقت المعالج بفترات تأخير delay slots حتى يجلب التعليمات المتتابعة، لأن المعالج يستغرق الوقت في جلب التعليمات أكثر من المعالجة. لم تسرع الخطوط المتوازية في أداء تلك المعالجات. تخلت الأجيال اللاحقة من معالجات RISC عن التعليمات القليلة البسيطة، و بدأت بإضافة الكثير من التعليمات المعقدة و المتخصصة التي تنفذ في دورات متعددة. و هذا الشيء موجود في معالجات PowerPC و ARM.

لما أصدرت أبل سلسلة رقاقاتها لحواسيب ماك الخاصة بها، عاد النقاش حول أهمية RISC، و كثرت المقارنات مع معالجات إنتل. تلك المقارنات توقفت منتصف 2022. بعدما تبين الكثير. لن أدخل كثيراً في التفاصيل لكن مراجعة Phoronix تخبر بجزء مما أريد قوله. تجربة الموقع كانت عن أداء أنظمة لينكس على مختلف الأجهزة، و الأداء هنا محصور على أنوية المعالج المركزي، لا يدخل فيها المعالج الرسومي أو معالجة الفيديو ProRes. في المراجعة نرى تباين في الأداء بين مختلف المعالجات في لينكس. يرى البعض تفوق معالجات AMD ثم إنتل للاستفادة من تعليمات SIMD. لكن الموضوع أكبر من SIMD. أجد هذه المراجعة أقرب للواقع، خصوصاً أن مراجعات أداء ماك برقاقات أبل يركز على المونتاج، لكن إن نظرنا لجوانب أخرى، نرى أنوية المعالج التيهي ARM أو RISC أو أي تسمية يرونها لا تتفوق ذلك التفوق الذي يروج له.

https://www.phoronix.com/review/apple-m2-linux/

نلاحظ أنه لا مقياس واضح يقاس به أداء المعالجات. المعالجات الحديثة ليست بتلك البساطة التي يظنها من ينشرون المحتوى في يوتيوب و غيره من المنصات. المعالجات الحديثة معقدة كثيراً لدرجة يصعب قياس أداؤها بدقة. برامج قياس الأداء benchmarks كلها قاصرة بلا استثناء. لم نصل بعد للهندسة الأفضل للمعالجات.


------------------------------------------------------------
على الهامش: لم أتطرق لمعالجات RISC-V لكن ما أعرفه أن كل ما يقال عن هذه المعالجات بلا دليل على أرض الواقع.